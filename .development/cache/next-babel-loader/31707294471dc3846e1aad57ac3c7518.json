{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs2/helpers/interopRequireDefault\");\n\nvar _Object$defineProperty2 = require(\"@babel/runtime-corejs2/core-js/object/define-property\");\n\n_Object$defineProperty2(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/object/define-property\"));\n\nvar _defineProperties = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/object/define-properties\"));\n\nvar _getOwnPropertyDescriptors = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\"));\n\nvar _getOwnPropertyDescriptor = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\"));\n\nvar _getOwnPropertySymbols = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\"));\n\nvar _keys = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/object/keys\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime-corejs2/regenerator\"));\n\nvar _defineProperty3 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/defineProperty\"));\n\nvar _stringify = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/json/stringify\"));\n\nvar _apiConfig = _interopRequireDefault(require(\"./api-config\"));\n\nvar _isomorphicUnfetch = _interopRequireDefault(require(\"isomorphic-unfetch\"));\n\nfunction ownKeys(object, enumerableOnly) { var keys = (0, _keys.default)(object); if (_getOwnPropertySymbols.default) { var symbols = (0, _getOwnPropertySymbols.default)(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return (0, _getOwnPropertyDescriptor.default)(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty3.default)(target, key, source[key]); }); } else if (_getOwnPropertyDescriptors.default) { (0, _defineProperties.default)(target, (0, _getOwnPropertyDescriptors.default)(source)); } else { ownKeys(Object(source)).forEach(function (key) { (0, _defineProperty2.default)(target, key, (0, _getOwnPropertyDescriptor.default)(source, key)); }); } } return target; }\n\nvar _callee = function _callee(_params) {\n  var _signal,\n      methods,\n      pass,\n      formData,\n      location,\n      request,\n      _ref,\n      _ref$return,\n      result,\n      _ref2,\n      _ref2$error,\n      error,\n      _args = arguments;\n\n  return _regenerator.default.async(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _signal = _args.length > 1 && _args[1] !== undefined ? _args[1] : false;\n          methods = _args.length > 2 && _args[2] !== undefined ? _args[2] : false;\n          pass = {\n            method: _params.method ? _params.method : \"POST\",\n            credentials: \"include\"\n          };\n\n          if (pass.method !== \"GET\" && pass.method !== \"HEAD\") {\n            if (_params.upload) {\n              formData = new FormData();\n              formData.append(\"data\", (0, _stringify.default)(_params));\n              if (_params.upload !== undefined) formData.append(\"upload\", _params.upload);\n              pass.body = formData;\n            } else {\n              pass.body = (0, _stringify.default)(_params ? _params : {});\n            }\n          }\n\n          location = _params.location ? _params.location : \"external\"; // do request\n\n          _context.prev = 5;\n\n          if (!_params.action) {\n            _context.next = 14;\n            break;\n          }\n\n          _context.next = 9;\n          return _regenerator.default.awrap((0, _isomorphicUnfetch.default)(_apiConfig.default.apipath + (location === \"local\" ? \"/\" + _params.action : _apiConfig.default.apiver + _params.action + (_params.params ? _params.params[0] === \"?\" ? _params.params : \"?\" + _params.params : \"\")), _signal ? _objectSpread({}, pass, {\n            signal: _signal.signal\n          }) : pass).then(function (d) {\n            return d.json();\n          }).then(function (d) {\n            return d;\n          }));\n\n        case 9:\n          request = _context.sent;\n          _ref = request || {}, _ref$return = _ref.return, result = _ref$return === void 0 ? {} : _ref$return;\n          _ref2 = result || {}, _ref2$error = _ref2.error, error = _ref2$error === void 0 ? false : _ref2$error;\n\n          if ((error && [\"logged_out_user\", \"unauthorized_request\"].indexOf(error.code) >= 0 || request.loginStatus === false) && methods && methods.loginStatus === true) {\n            _signal.abort && _signal.abort();\n            methods.logout(request.loginStatus);\n          } else if (error && error.code === \"permission_no_rights\") {\n            alert(\"No permissions\");\n          }\n\n          return _context.abrupt(\"return\", result);\n\n        case 14:\n          _context.next = 19;\n          break;\n\n        case 16:\n          _context.prev = 16;\n          _context.t0 = _context[\"catch\"](5);\n          console.log(\"Request Aborted..\", _context.t0);\n\n        case 19:\n          return _context.abrupt(\"return\", false);\n\n        case 20:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[5, 16]]);\n};\n\nexports.default = _callee;","map":{"version":3,"sources":["/Users/stanislavohstany/WebApps/DEV/coronamap/src/api.js"],"names":["_params","_signal","methods","pass","method","credentials","upload","formData","FormData","append","undefined","body","location","action","settings","apipath","apiver","params","signal","then","d","json","request","return","result","error","indexOf","code","loginStatus","abort","logout","alert","console","log"],"mappings":"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","sourcesContent":["import settings from \"api-config\";\nimport fetch from \"isomorphic-unfetch\";\n\nexport default async (_params, _signal = false, methods = false) => {\n\tconst pass = {\n\t\tmethod: _params.method ? _params.method : \"POST\",\n\t\tcredentials: \"include\"\n\t};\n\n\tif (pass.method !== \"GET\" && pass.method !== \"HEAD\") {\n\t\tif (_params.upload) {\n\t\t\tconst formData = new FormData();\n\t\t\tformData.append(\"data\", JSON.stringify(_params));\n\t\t\tif (_params.upload !== undefined)\n\t\t\t\tformData.append(\"upload\", _params.upload);\n\t\t\tpass.body = formData;\n\t\t} else {\n\t\t\tpass.body = JSON.stringify(_params ? _params : {});\n\t\t}\n\t}\n\n\tconst location = _params.location ? _params.location : \"external\";\n\n\t// do request\n\ttry {\n\t\tif (_params.action) {\n\t\t\tconst request = await fetch(\n\t\t\t\tsettings.apipath +\n\t\t\t\t\t(location === \"local\"\n\t\t\t\t\t\t? \"/\" + _params.action\n\t\t\t\t\t\t: settings.apiver +\n\t\t\t\t\t\t  _params.action +\n\t\t\t\t\t\t  (_params.params\n\t\t\t\t\t\t\t\t? _params.params[0] === \"?\"\n\t\t\t\t\t\t\t\t\t? _params.params\n\t\t\t\t\t\t\t\t\t: \"?\" + _params.params\n\t\t\t\t\t\t\t\t: \"\")),\n\t\t\t\t_signal ? { ...pass, signal: _signal.signal } : pass\n\t\t\t)\n\t\t\t\t.then(d => d.json())\n\t\t\t\t.then(d => d);\n\n\t\t\tconst { return: result = {} } = request || {};\n\n\t\t\tconst { error = false } = result || {};\n\n\t\t\tif (\n\t\t\t\t((error &&\n\t\t\t\t\t[\"logged_out_user\", \"unauthorized_request\"].indexOf(\n\t\t\t\t\t\terror.code\n\t\t\t\t\t) >= 0) ||\n\t\t\t\t\trequest.loginStatus === false) &&\n\t\t\t\tmethods &&\n\t\t\t\tmethods.loginStatus === true\n\t\t\t) {\n\t\t\t\t_signal.abort && _signal.abort();\n\t\t\t\tmethods.logout(request.loginStatus);\n\t\t\t} else if (error && error.code === \"permission_no_rights\") {\n\t\t\t\talert(\"No permissions\");\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t} catch (e) {\n\t\tconsole.log(\"Request Aborted..\", e);\n\t}\n\treturn false;\n};\n"]},"metadata":{},"sourceType":"script"}