{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.RootProvider = void 0;\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _api = _interopRequireDefault(require(\"../api\"));\n\nvar _router = require(\"next/router\");\n\nvar _reducers = require(\"./reducers\");\n\nvar _actions = require(\"./actions\");\n\nvar _jsxFileName = \"/Users/stanislavohstany/WebApps/DEV/coronamap/src/Context/index.js\";\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar __jsx = _react.default.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nconst w = {\n  device: \"pc\"\n};\n\nif (false) {\n  w.device = window.innerWidth > 768 ? \"pc\" : \"mobile\";\n  document.body.classList.add(w.device);\n} // common global context\n\n\nconst RootContext = (0, _react.createContext)({});\n\nconst finalizeStore = async ({\n  store,\n  actions,\n  reducer\n}, single, {\n  loginStatus,\n  logout\n}, signal) => {\n  const {\n    reduce\n  } = single || {};\n  if (!reduce) return false;\n\n  const actionExist = _objectSpread({}, actions[reduce] || {}, {}, single);\n\n  if (!actionExist.action || actionExist.api === false) {\n    return reducer(store, {\n      reduce,\n      data: actionExist.data || false\n    });\n  }\n\n  return reducer(store, {\n    reduce,\n    data: await (0, _api.default)(actionExist, signal, {\n      logout,\n      loginStatus\n    })\n  }, actionExist);\n};\n\nconst setStoreReducer = (state, data) => {\n  return _objectSpread({}, state, {}, data);\n}; // Context as global app store\n\n\nconst RootProvider = (0, _router.withRouter)(props => {\n  const {\n    loginStatus,\n    logout,\n    children\n  } = props;\n  const {\n    0: store,\n    1: setStore\n  } = (0, _react.useReducer)(setStoreReducer, _reducers.root_store_initial_state);\n\n  const actioner = async apiParams => {\n    const updater = {\n      api: apiParams,\n      toState: {},\n      signals: []\n    };\n    /** ARRAY:   if type is array we are able to make several\n     *           api request, reduce them, and then assign all data at once to the state\n     *  OBJECT:  single api request, reduce and state setter\n     */\n\n    if (updater.api instanceof Array) {\n      updater.toState = Object.assign({}, (await Promise.all(updater.api.map(async (single, x) => {\n        updater.signals[x] = new window.AbortController();\n        return await finalizeStore({\n          store,\n          actions: _actions.rootActions,\n          reducer: _reducers.root_store_reducer\n        }, single, {\n          loginStatus,\n          logout\n        }, updater.signals[x]);\n      }))).reduce((p, n) => Object.assign({}, p, n), {}));\n    } else {\n      updater.signals[0] = new window.AbortController();\n      updater.toState = await finalizeStore({\n        store,\n        actions: _actions.rootActions,\n        reducer: _reducers.root_store_reducer\n      }, apiParams, {\n        loginStatus,\n        logout\n      }, updater.signals[0]);\n    }\n\n    if (updater.toState) {\n      if (apiParams.set !== false) {\n        setStore(updater.toState);\n        return updater.toState;\n      } else {\n        return {\n          data: updater.toState,\n          set: setStore\n        };\n      }\n    }\n\n    return function clean() {\n      updater.signals.map(s => {\n        s.abort();\n      });\n    };\n  };\n\n  const {\n    0: device,\n    1: _device\n  } = (0, _react.useState)(\"pc\");\n\n  const getScreenState = e => {\n    e.preventDefault();\n\n    _device(s => {\n      const canSet = s === \"mobile\" && window.innerWidth > 768 ? \"pc\" : s === \"pc\" && window.innerWidth <= 768 ? \"mobile\" : false;\n\n      if (canSet) {\n        document.body.classList.remove(canSet === \"mobile\" ? \"pc\" : \"mobile\");\n        document.body.classList.add(canSet);\n      }\n\n      return canSet || s;\n    });\n  };\n\n  (0, _react.useEffect)(() => {\n    if (false) {\n      const dev = window.innerWidth > 768 ? \"pc\" : \"mobile\";\n\n      _device(dev);\n\n      document.body.classList.add(dev);\n      window.addEventListener(\"resize\", getScreenState);\n    }\n  }, []);\n\n  const api = (data, signal = false) => {\n    return (0, _api.default)(data, signal, {\n      logout,\n      loginStatus: state.loginStatus\n    });\n  };\n\n  return __jsx(RootContext.Provider, {\n    value: {\n      store,\n      actioner,\n      device,\n      api\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: void 0\n  }, children);\n});\nexports.RootProvider = RootProvider;\nvar _default = RootContext;\nexports.default = _default;","map":{"version":3,"sources":["/Users/stanislavohstany/WebApps/DEV/coronamap/src/Context/index.js"],"names":["w","device","window","innerWidth","document","body","classList","add","RootContext","finalizeStore","store","actions","reducer","single","loginStatus","logout","signal","reduce","actionExist","action","api","data","setStoreReducer","state","RootProvider","props","children","setStore","root_store_initial_state","actioner","apiParams","updater","toState","signals","Array","Object","assign","Promise","all","map","x","AbortController","rootActions","root_store_reducer","p","n","set","clean","s","abort","_device","getScreenState","e","preventDefault","canSet","remove","dev","addEventListener"],"mappings":"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","sourcesContent":["import React, { createContext, useEffect, useReducer, useState } from \"react\";\nimport bpis from \"api\";\n\nimport { withRouter } from \"next/router\";\n\nimport { root_store_reducer, root_store_initial_state } from \"./reducers\";\n\nimport { rootActions } from \"./actions\";\n\nconst w = { device: \"pc\" };\n\nif (typeof window !== \"undefined\") {\n\tw.device = window.innerWidth > 768 ? \"pc\" : \"mobile\";\n\tdocument.body.classList.add(w.device);\n}\n\n// common global context\nconst RootContext = createContext({});\n\nconst finalizeStore = async (\n\t{ store, actions, reducer },\n\tsingle,\n\t{ loginStatus, logout },\n\tsignal\n) => {\n\tconst { reduce } = single || {};\n\n\tif (!reduce) return false;\n\n\tconst actionExist = {\n\t\t...(actions[reduce] || {}),\n\t\t...single\n\t};\n\n\tif (!actionExist.action || actionExist.api === false) {\n\t\treturn reducer(store, {\n\t\t\treduce,\n\t\t\tdata: actionExist.data || false\n\t\t});\n\t}\n\n\treturn reducer(\n\t\tstore,\n\t\t{\n\t\t\treduce,\n\t\t\tdata: await bpis(actionExist, signal, {\n\t\t\t\tlogout,\n\t\t\t\tloginStatus\n\t\t\t})\n\t\t},\n\t\tactionExist\n\t);\n};\n\nconst setStoreReducer = (state, data) => {\n\treturn { ...state, ...data };\n};\n\n// Context as global app store\nexport const RootProvider = withRouter(props => {\n\tconst { loginStatus, logout, children } = props;\n\n\tconst [store, setStore] = useReducer(\n\t\tsetStoreReducer,\n\t\troot_store_initial_state\n\t);\n\n\tconst actioner = async apiParams => {\n\t\tconst updater = { api: apiParams, toState: {}, signals: [] };\n\t\t/** ARRAY:   if type is array we are able to make several\n\t\t *           api request, reduce them, and then assign all data at once to the state\n\t\t *  OBJECT:  single api request, reduce and state setter\n\t\t */\n\t\tif (updater.api instanceof Array) {\n\t\t\tupdater.toState = Object.assign(\n\t\t\t\t{},\n\t\t\t\t(\n\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\tupdater.api.map(async (single, x) => {\n\t\t\t\t\t\t\tupdater.signals[x] = new window.AbortController();\n\t\t\t\t\t\t\treturn await finalizeStore(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstore,\n\t\t\t\t\t\t\t\t\tactions: rootActions,\n\t\t\t\t\t\t\t\t\treducer: root_store_reducer\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tsingle,\n\t\t\t\t\t\t\t\t{ loginStatus, logout },\n\t\t\t\t\t\t\t\tupdater.signals[x]\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})\n\t\t\t\t\t)\n\t\t\t\t).reduce((p, n) => Object.assign({}, p, n), {})\n\t\t\t);\n\t\t} else {\n\t\t\tupdater.signals[0] = new window.AbortController();\n\t\t\tupdater.toState = await finalizeStore(\n\t\t\t\t{ store, actions: rootActions, reducer: root_store_reducer },\n\t\t\t\tapiParams,\n\t\t\t\t{ loginStatus, logout },\n\t\t\t\tupdater.signals[0]\n\t\t\t);\n\t\t}\n\n\t\tif (updater.toState) {\n\t\t\tif (apiParams.set !== false) {\n\t\t\t\tsetStore(updater.toState);\n\t\t\t\treturn updater.toState;\n\t\t\t} else {\n\t\t\t\treturn { data: updater.toState, set: setStore };\n\t\t\t}\n\t\t}\n\n\t\treturn function clean() {\n\t\t\tupdater.signals.map(s => {\n\t\t\t\ts.abort();\n\t\t\t});\n\t\t};\n\t};\n\n\tconst [device, _device] = useState(\"pc\");\n\n\tconst getScreenState = e => {\n\t\te.preventDefault();\n\t\t_device(s => {\n\t\t\tconst canSet =\n\t\t\t\ts === \"mobile\" && window.innerWidth > 768\n\t\t\t\t\t? \"pc\"\n\t\t\t\t\t: s === \"pc\" && window.innerWidth <= 768\n\t\t\t\t\t? \"mobile\"\n\t\t\t\t\t: false;\n\t\t\tif (canSet) {\n\t\t\t\tdocument.body.classList.remove(\n\t\t\t\t\tcanSet === \"mobile\" ? \"pc\" : \"mobile\"\n\t\t\t\t);\n\t\t\t\tdocument.body.classList.add(canSet);\n\t\t\t}\n\t\t\treturn canSet || s;\n\t\t});\n\t};\n\n\tuseEffect(() => {\n\t\tif (typeof window !== \"undefined\") {\n\t\t\tconst dev = window.innerWidth > 768 ? \"pc\" : \"mobile\";\n\t\t\t_device(dev);\n\t\t\tdocument.body.classList.add(dev);\n\t\t\twindow.addEventListener(\"resize\", getScreenState);\n\t\t}\n\t}, []);\n\n\tconst api = (data, signal = false) => {\n\t\treturn bpis(data, signal, {\n\t\t\tlogout,\n\t\t\tloginStatus: state.loginStatus\n\t\t});\n\t};\n\n\treturn (\n\t\t<RootContext.Provider\n\t\t\tvalue={{\n\t\t\t\tstore,\n\t\t\t\tactioner,\n\t\t\t\tdevice,\n\t\t\t\tapi\n\t\t\t}}>\n\t\t\t{children}\n\t\t</RootContext.Provider>\n\t);\n});\n\nexport default RootContext;\n"]},"metadata":{},"sourceType":"script"}