{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _apiConfig = _interopRequireDefault(require(\"./api-config\"));\n\nvar _isomorphicUnfetch = _interopRequireDefault(require(\"isomorphic-unfetch\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar _default = async (_params, _signal = false, methods = false) => {\n  const pass = {\n    method: _params.method ? _params.method : \"POST\",\n    credentials: \"include\"\n  };\n\n  if (pass.method !== \"GET\" && pass.method !== \"HEAD\") {\n    if (_params.upload) {\n      const formData = new FormData();\n      formData.append(\"data\", JSON.stringify(_params));\n      if (_params.upload !== undefined) formData.append(\"upload\", _params.upload);\n      pass.body = formData;\n    } else {\n      pass.body = JSON.stringify(_params ? _params : {});\n    }\n  }\n\n  const location = _params.location ? _params.location : \"external\"; // do request\n\n  try {\n    if (_params.action) {\n      const request = await (0, _isomorphicUnfetch.default)(_apiConfig.default.apipath + (location === \"local\" ? \"/\" + _params.action : _apiConfig.default.apiver + _params.action + (_params.params ? _params.params[0] === \"?\" ? _params.params : \"?\" + _params.params : \"\")), _signal ? _objectSpread({}, pass, {\n        signal: _signal.signal\n      }) : pass).then(d => d.json()).then(d => d);\n      const {\n        return: result = {}\n      } = request || {};\n      const {\n        error = false\n      } = result || {};\n\n      if ((error && [\"logged_out_user\", \"unauthorized_request\"].indexOf(error.code) >= 0 || request.loginStatus === false) && methods && methods.loginStatus === true) {\n        _signal.abort && _signal.abort();\n        methods.logout(request.loginStatus);\n      } else if (error && error.code === \"permission_no_rights\") {\n        alert(\"No permissions\");\n      }\n\n      return result;\n    }\n  } catch (e) {\n    console.log(\"Request Aborted..\", e);\n  }\n\n  return false;\n};\n\nexports.default = _default;","map":{"version":3,"sources":["/Users/stanislavohstany/WebApps/DEV/coronamap/src/api.js"],"names":["_params","_signal","methods","pass","method","credentials","upload","formData","FormData","append","JSON","stringify","undefined","body","location","action","request","settings","apipath","apiver","params","signal","then","d","json","return","result","error","indexOf","code","loginStatus","abort","logout","alert","e","console","log"],"mappings":";;;;;;;AAAA;;AACA;;;;;;;;;;eAEe,OAAOA,OAAP,EAAgBC,OAAO,GAAG,KAA1B,EAAiCC,OAAO,GAAG,KAA3C,KAAqD;AACnE,QAAMC,IAAI,GAAG;AACZC,IAAAA,MAAM,EAAEJ,OAAO,CAACI,MAAR,GAAiBJ,OAAO,CAACI,MAAzB,GAAkC,MAD9B;AAEZC,IAAAA,WAAW,EAAE;AAFD,GAAb;;AAKA,MAAIF,IAAI,CAACC,MAAL,KAAgB,KAAhB,IAAyBD,IAAI,CAACC,MAAL,KAAgB,MAA7C,EAAqD;AACpD,QAAIJ,OAAO,CAACM,MAAZ,EAAoB;AACnB,YAAMC,QAAQ,GAAG,IAAIC,QAAJ,EAAjB;AACAD,MAAAA,QAAQ,CAACE,MAAT,CAAgB,MAAhB,EAAwBC,IAAI,CAACC,SAAL,CAAeX,OAAf,CAAxB;AACA,UAAIA,OAAO,CAACM,MAAR,KAAmBM,SAAvB,EACCL,QAAQ,CAACE,MAAT,CAAgB,QAAhB,EAA0BT,OAAO,CAACM,MAAlC;AACDH,MAAAA,IAAI,CAACU,IAAL,GAAYN,QAAZ;AACA,KAND,MAMO;AACNJ,MAAAA,IAAI,CAACU,IAAL,GAAYH,IAAI,CAACC,SAAL,CAAeX,OAAO,GAAGA,OAAH,GAAa,EAAnC,CAAZ;AACA;AACD;;AAED,QAAMc,QAAQ,GAAGd,OAAO,CAACc,QAAR,GAAmBd,OAAO,CAACc,QAA3B,GAAsC,UAAvD,CAlBmE,CAoBnE;;AACA,MAAI;AACH,QAAId,OAAO,CAACe,MAAZ,EAAoB;AACnB,YAAMC,OAAO,GAAG,MAAM,gCACrBC,mBAASC,OAAT,IACEJ,QAAQ,KAAK,OAAb,GACE,MAAMd,OAAO,CAACe,MADhB,GAEEE,mBAASE,MAAT,GACAnB,OAAO,CAACe,MADR,IAECf,OAAO,CAACoB,MAAR,GACCpB,OAAO,CAACoB,MAAR,CAAe,CAAf,MAAsB,GAAtB,GACCpB,OAAO,CAACoB,MADT,GAEC,MAAMpB,OAAO,CAACoB,MAHhB,GAIC,EANF,CAHJ,CADqB,EAWrBnB,OAAO,qBAAQE,IAAR;AAAckB,QAAAA,MAAM,EAAEpB,OAAO,CAACoB;AAA9B,WAAyClB,IAX3B,EAapBmB,IAboB,CAafC,CAAC,IAAIA,CAAC,CAACC,IAAF,EAbU,EAcpBF,IAdoB,CAcfC,CAAC,IAAIA,CAdU,CAAtB;AAgBA,YAAM;AAAEE,QAAAA,MAAM,EAAEC,MAAM,GAAG;AAAnB,UAA0BV,OAAO,IAAI,EAA3C;AAEA,YAAM;AAAEW,QAAAA,KAAK,GAAG;AAAV,UAAoBD,MAAM,IAAI,EAApC;;AAEA,UACC,CAAEC,KAAK,IACN,CAAC,iBAAD,EAAoB,sBAApB,EAA4CC,OAA5C,CACCD,KAAK,CAACE,IADP,KAEK,CAHL,IAIAb,OAAO,CAACc,WAAR,KAAwB,KAJzB,KAKA5B,OALA,IAMAA,OAAO,CAAC4B,WAAR,KAAwB,IAPzB,EAQE;AACD7B,QAAAA,OAAO,CAAC8B,KAAR,IAAiB9B,OAAO,CAAC8B,KAAR,EAAjB;AACA7B,QAAAA,OAAO,CAAC8B,MAAR,CAAehB,OAAO,CAACc,WAAvB;AACA,OAXD,MAWO,IAAIH,KAAK,IAAIA,KAAK,CAACE,IAAN,KAAe,sBAA5B,EAAoD;AAC1DI,QAAAA,KAAK,CAAC,gBAAD,CAAL;AACA;;AAED,aAAOP,MAAP;AACA;AACD,GAvCD,CAuCE,OAAOQ,CAAP,EAAU;AACXC,IAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAiCF,CAAjC;AACA;;AACD,SAAO,KAAP;AACA,C","sourcesContent":["import settings from \"api-config\";\nimport fetch from \"isomorphic-unfetch\";\n\nexport default async (_params, _signal = false, methods = false) => {\n\tconst pass = {\n\t\tmethod: _params.method ? _params.method : \"POST\",\n\t\tcredentials: \"include\"\n\t};\n\n\tif (pass.method !== \"GET\" && pass.method !== \"HEAD\") {\n\t\tif (_params.upload) {\n\t\t\tconst formData = new FormData();\n\t\t\tformData.append(\"data\", JSON.stringify(_params));\n\t\t\tif (_params.upload !== undefined)\n\t\t\t\tformData.append(\"upload\", _params.upload);\n\t\t\tpass.body = formData;\n\t\t} else {\n\t\t\tpass.body = JSON.stringify(_params ? _params : {});\n\t\t}\n\t}\n\n\tconst location = _params.location ? _params.location : \"external\";\n\n\t// do request\n\ttry {\n\t\tif (_params.action) {\n\t\t\tconst request = await fetch(\n\t\t\t\tsettings.apipath +\n\t\t\t\t\t(location === \"local\"\n\t\t\t\t\t\t? \"/\" + _params.action\n\t\t\t\t\t\t: settings.apiver +\n\t\t\t\t\t\t  _params.action +\n\t\t\t\t\t\t  (_params.params\n\t\t\t\t\t\t\t\t? _params.params[0] === \"?\"\n\t\t\t\t\t\t\t\t\t? _params.params\n\t\t\t\t\t\t\t\t\t: \"?\" + _params.params\n\t\t\t\t\t\t\t\t: \"\")),\n\t\t\t\t_signal ? { ...pass, signal: _signal.signal } : pass\n\t\t\t)\n\t\t\t\t.then(d => d.json())\n\t\t\t\t.then(d => d);\n\n\t\t\tconst { return: result = {} } = request || {};\n\n\t\t\tconst { error = false } = result || {};\n\n\t\t\tif (\n\t\t\t\t((error &&\n\t\t\t\t\t[\"logged_out_user\", \"unauthorized_request\"].indexOf(\n\t\t\t\t\t\terror.code\n\t\t\t\t\t) >= 0) ||\n\t\t\t\t\trequest.loginStatus === false) &&\n\t\t\t\tmethods &&\n\t\t\t\tmethods.loginStatus === true\n\t\t\t) {\n\t\t\t\t_signal.abort && _signal.abort();\n\t\t\t\tmethods.logout(request.loginStatus);\n\t\t\t} else if (error && error.code === \"permission_no_rights\") {\n\t\t\t\talert(\"No permissions\");\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t} catch (e) {\n\t\tconsole.log(\"Request Aborted..\", e);\n\t}\n\treturn false;\n};\n"]},"metadata":{},"sourceType":"script"}